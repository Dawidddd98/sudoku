<script>
  let selectedCell = null;
  let mistakes = 0;
  let timer = 0;
  let timerInterval = null;

  function updateTimer() {
    timer++;
    document.getElementById("timer").textContent = `Time: ${timer}s`;
  }

  function startTimer() {
    timer = 0;
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateTimer, 1000);
  }

  function addMistake() {
    mistakes++;
    document.getElementById("mistakes").textContent = `Mistakes: ${mistakes}/3`;
    if (mistakes >= 3) {
      document.getElementById("status").textContent = "Game over! New board in 1s...";
      clearInterval(timerInterval);
      setTimeout(() => generateBoard(), 1000);
    }
  }

  function placeNumber(num) {
    if (!selectedCell) return;
    if (selectedCell.textContent !== "") return;
    if (selectedCell.dataset.correct == num) {
      selectedCell.textContent = num;
      selectedCell.classList.remove("incorrect");
    } else {
      selectedCell.classList.add("incorrect");
      addMistake();
    }
  }

  function toggleDarkMode() {
    document.body.classList.toggle("dark");
  }

  function setLanguage(lang) {
    console.log("Language set to:", lang); // placeholder
  }

  function generateBoard() {
    const boardElement = document.getElementById("board");
    boardElement.innerHTML = "";
    mistakes = 0;
    timer = 0;
    document.getElementById("mistakes").textContent = `Mistakes: 0/3`;
    document.getElementById("status").textContent = "";
    document.getElementById("timer").textContent = `Time: 0s`;
    startTimer();

    const puzzle = [
      [5, 3, '', '', 7, '', '', '', ''],
      [6, '', '', 1, 9, 5, '', '', ''],
      ['', 9, 8, '', '', '', '', 6, ''],
      [8, '', '', '', 6, '', '', '', 3],
      [4, '', '', 8, '', 3, '', '', 1],
      [7, '', '', '', 2, '', '', '', 6],
      ['', 6, '', '', '', '', 2, 8, ''],
      ['', '', '', 4, 1, 9, '', '', 5],
      ['', '', '', '', 8, '', '', 7, 9],
    ];
    const solution = [
      [5,3,4,6,7,8,9,1,2],
      [6,7,2,1,9,5,3,4,8],
      [1,9,8,3,4,2,5,6,7],
      [8,5,9,7,6,1,4,2,3],
      [4,2,6,8,5,3,7,9,1],
      [7,1,3,9,2,4,8,5,6],
      [9,6,1,5,3,7,2,8,4],
      [2,8,7,4,1,9,6,3,5],
      [3,4,5,2,8,6,1,7,9],
    ];

    for (let i = 0; i < 9; i++) {
      for (let j = 0; j < 9; j++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        if (i % 3 === 0) cell.classList.add("thick-top");
        if (j % 3 === 0) cell.classList.add("thick-left");
        if ((i + 1) % 3 === 0) cell.classList.add("thick-bottom");
        if ((j + 1) % 3 === 0) cell.classList.add("thick-right");
        cell.dataset.correct = solution[i][j];
        if (puzzle[i][j]) {
          cell.textContent = puzzle[i][j];
          cell.style.pointerEvents = "none";
        }
        cell.addEventListener("click", () => {
          if (selectedCell) selectedCell.classList.remove("selected");
          selectedCell = cell;
          cell.classList.add("selected");
        });
        boardElement.appendChild(cell);
      }
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    generateBoard();
  });
</script>
