<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sudoku</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      background-color: #f4f4f4;
      color: #333;
      padding: 20px;
    }
    #left-panel {
      margin-right: 40px;
    }
    #controls, #message {
      margin-bottom: 20px;
      text-align: left;
    }
    #sudoku-board {
      display: grid;
      grid-template-columns: repeat(9, 50px);
      gap: 0;
      border: 3px solid #000;
    }
    #sudoku-board input {
      width: 50px;
      height: 50px;
      font-size: 20px;
      text-align: center;
      border: 1px solid #ccc;
    }
    #sudoku-board input.given {
      background-color: #ddd;
    }
    #sudoku-board input.active {
      border: 2px solid #007BFF;
    }
    #sudoku-board input {
      box-sizing: border-box;
    }
    #sudoku-board input:nth-child(3n+1) {
      border-left: 3px solid #000;
    }
    #sudoku-board input:nth-child(n+1):nth-child(-n+9) {
      border-top: 3px solid #000;
    }
    #sudoku-board input:nth-child(n+19):nth-child(-n+27),
    #sudoku-board input:nth-child(n+46):nth-child(-n+54),
    #sudoku-board input:nth-child(n+73):nth-child(-n+81) {
      border-bottom: 1px solid #ccc;
    }
    #sudoku-board input:nth-child(n+55):nth-child(-n+81) {
      border-bottom: 3px solid #000;
    }
    #number-pad {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 5px;
    }
    #number-pad button {
      width: 60px;
      height: 60px;
      font-size: 20px;
      margin: 0;
    }
    footer {
      display: none;
    }
  </style>
</head>
<body>
  <div id="left-panel">
    <div id="controls">
      <button id="new-game" data-i18n="newGame">Nowa gra</button>
      <select id="difficulty-select">
        <option value="easy" data-i18n="easy">Łatwy</option>
        <option value="medium" data-i18n="medium" selected>Średni</option>
        <option value="hard" data-i18n="hard">Trudny</option>
      </select>
      <button id="hint-btn" data-i18n="hint">Podpowiedź</button>
      <button onclick="toggleDarkMode()" data-i18n="darkMode">Tryb ciemny</button>
      <label for="language-select" data-i18n="language">Język:</label>
      <select id="language-select">
        <option value="pl" selected>Polski</option>
        <option value="en">English</option>
      </select>
      <div><span data-i18n="errors">Błędy:</span> <span id="errors">0</span></div>
      <div><span data-i18n="time">Czas:</span> <span id="timer">00:00</span></div>
    </div>

    <div id="sudoku-board"></div>

    <div id="message" data-i18n="message"></div>
  </div>

  <div id="number-pad">
    <button class="num">1</button>
    <button class="num">2</button>
    <button class="num">3</button>
    <button class="num">4</button>
    <button class="num">5</button>
    <button class="num">6</button>
    <button class="num">7</button>
    <button class="num">8</button>
    <button class="num">9</button>
  </div>

  <script>
    const translations = {
      pl: {
        newGame: "Nowa gra", easy: "Łatwy", medium: "Średni", hard: "Trudny", hint: "Podpowiedź", darkMode: "Tryb ciemny", language: "Język:", errors: "Błędy:", time: "Czas:", message: "", win: "Gratulacje! Rozwiązałeś Sudoku.", lose: "Popełniłeś 3 błędy. Koniec gry."
      },
      en: {
        newGame: "New Game", easy: "Easy", medium: "Medium", hard: "Hard", hint: "Hint", darkMode: "Dark Mode", language: "Language:", errors: "Errors:", time: "Time:", message: "", win: "Congratulations! You solved the puzzle.", lose: "You made 3 mistakes. Game over."
      }
    };

    function updateLanguage(lang) {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      localStorage.setItem('sudokuLang', lang);
      document.getElementById('language-select').value = lang;
    }

    document.getElementById('language-select').addEventListener('change', (e) => {
      updateLanguage(e.target.value);
    });

    const savedLang = localStorage.getItem('sudokuLang') || 'pl';
    updateLanguage(savedLang);

    let errorCount = 0;

    function generateEmptyBoard() {
      const board = document.getElementById('sudoku-board');
      board.innerHTML = '';
      for (let i = 0; i < 81; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.maxLength = 1;
        input.dataset.index = i;
        if (Math.random() < 0.2) {
          input.value = String(Math.floor(Math.random() * 9) + 1);
          input.disabled = true;
          input.classList.add('given');
        }
        input.addEventListener('focus', () => {
          document.querySelectorAll('#sudoku-board input').forEach(el => el.classList.remove('active'));
          input.classList.add('active');
        });
        input.addEventListener('input', () => validateInput(input));
        board.appendChild(input);
      }
      errorCount = 0;
      document.getElementById('errors').textContent = errorCount;
      document.getElementById('message').textContent = '';
    }

    function validateInput(input) {
      const value = input.value;
      const valid = /^[1-9]$/.test(value);
      if (!valid) {
        input.value = '';
        return;
      }
      const index = parseInt(input.dataset.index);
      const row = Math.floor(index / 9);
      const col = index % 9;
      const boardInputs = document.querySelectorAll('#sudoku-board input');

      let isValid = true;
      for (let i = 0; i < 9; i++) {
        const rowInput = boardInputs[row * 9 + i];
        const colInput = boardInputs[i * 9 + col];
        const boxInput = boardInputs[3 * Math.floor(row / 3) * 9 + 3 * Math.floor(col / 3) + 3 * Math.floor(i / 3) + i % 3];

        if ((rowInput !== input && rowInput.value === value) ||
            (colInput !== input && colInput.value === value) ||
            (boxInput !== input && boxInput.value === value)) {
          isValid = false;
          break;
        }
      }

      input.style.backgroundColor = isValid ? '' : 'salmon';

      if (!isValid) {
        errorCount++;
        document.getElementById('errors').textContent = errorCount;
        if (errorCount >= 3) {
          document.getElementById('message').textContent = translations[savedLang].lose;
          setTimeout(generateEmptyBoard, 2000);
        }
      } else {
        checkWinCondition();
      }
    }

    function checkWinCondition() {
      const boardInputs = document.querySelectorAll('#sudoku-board input');
      for (let input of boardInputs) {
        if (!input.value || !/^[1-9]$/.test(input.value)) {
          return;
        }
      }
      document.getElementById('message').textContent = translations[savedLang].win;
    }

    generateEmptyBoard();

    document.getElementById('new-game').addEventListener('click', generateEmptyBoard);

    document.querySelectorAll('#number-pad .num').forEach(button => {
      button.addEventListener('click', () => {
        const active = document.querySelector('#sudoku-board input.active:not(:disabled)');
        if (active) {
          active.value = button.textContent;
          validateInput(active);
        }
      });
    });
  </script>
</body>
</html>
