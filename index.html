<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sudoku Game</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f4;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    body.dark {
      background-color: #121212;
      color: #eee;
    }

    #controls {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #sudoku-board {
      display: grid;
      grid-template-columns: repeat(9, 40px);
      gap: 1px;
    }

    #sudoku-board input {
      width: 38px;
      height: 38px;
      text-align: center;
      font-size: 18px;
      border: 1px solid #ccc;
      background-color: white;
    }

    #sudoku-board input.given {
      background-color: #e0e0e0;
    }

    #sudoku-board input.active {
      border: 2px solid #3399ff !important;
      background: #e6f2ff;
    }

    body.dark #sudoku-board input {
      background-color: #1e1e1e;
      color: #eee;
    }

    body.dark #sudoku-board input.given {
      background-color: #333;
    }

    body.dark #sudoku-board input.active {
      background-color: #1e2a33;
      border-color: #66ccff !important;
    }

    #number-pad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
      max-width: 200px;
      margin-inline: auto;
    }

    #number-pad button {
      font-size: 18px;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #999;
      background: #f0f0f0;
      cursor: pointer;
    }

    body.dark #number-pad button {
      background: #2a2a2a;
      color: #eee;
      border-color: #444;
    }

    #message {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="generateGameBoard()">New Game</button>
    <select id="difficulty-select">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button id="hint-btn">Hint</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <div>Errors: <span id="errors">0</span></div>
    <div>Timer: <span id="timer">00:00</span></div>
  </div>

  <div id="sudoku-board"></div>

  <div id="number-pad">
    <button class="num">1</button>
    <button class="num">2</button>
    <button class="num">3</button>
    <button class="num">4</button>
    <button class="num">5</button>
    <button class="num">6</button>
    <button class="num">7</button>
    <button class="num">8</button>
    <button class="num">9</button>
  </div>

  <div id="message"></div>

  <script>
    let board = document.getElementById('sudoku-board');
    let solution = [];
    let errorCount = 0;
    let timerInterval;
    let time = 0;
    let hintUsed = false;
    let selectedCell = null;

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function startTimer() {
      clearInterval(timerInterval);
      time = 0;
      updateTimer();
      timerInterval = setInterval(() => {
        time++;
        updateTimer();
      }, 1000);
    }

    function updateTimer() {
      let minutes = Math.floor(time / 60).toString().padStart(2, '0');
      let seconds = (time % 60).toString().padStart(2, '0');
      document.getElementById('timer').textContent = `${minutes}:${seconds}`;
    }

    function updateErrors() {
      document.getElementById('errors').textContent = errorCount;
    }

    function endGame(victory) {
      clearInterval(timerInterval);
      const message = document.getElementById('message');
      message.textContent = victory ? 'You Win!' : 'You Lost!';
      setTimeout(() => {
        message.textContent = '';
        generateGameBoard();
        startTimer();
      }, 2000);
    }

    function checkVictory() {
      const inputs = board.querySelectorAll('input');
      for (const input of inputs) {
        if (!input.disabled) return;
      }
      endGame(true);
    }

    function giveHint() {
      if (hintUsed) return;
      hintUsed = true;
      const inputs = board.querySelectorAll('input');
      const emptyCells = Array.from(inputs).filter(input => {
        const row = input.dataset.row;
        const col = input.dataset.col;
        return !input.disabled && input.value === '';
      });
      if (emptyCells.length === 0) return;
      const cell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      const row = cell.dataset.row;
      const col = cell.dataset.col;
      cell.value = solution[row][col];
      cell.disabled = true;
      cell.classList.remove('error');
      document.getElementById('hint-btn').disabled = true;
      checkVictory();
    }

    function generateGameBoard() {
      hintUsed = false;
      document.getElementById('hint-btn').disabled = false;
      errorCount = 0;
      updateErrors();
      selectedCell = null;

      const { puzzle, solved } = generateSudokuPuzzle();
      solution = solved;

      board.innerHTML = '';
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const cell = document.createElement('input');
          cell.setAttribute('type', 'text');
          cell.setAttribute('maxlength', '1');
          cell.dataset.row = row;
          cell.dataset.col = col;

          const value = puzzle[row][col];
          if (value !== '-') {
            cell.value = value;
            cell.disabled = true;
            cell.classList.add('given');
          }

          if (col % 3 === 0) cell.style.borderLeft = '2px solid #333';
          if (row % 3 === 0) cell.style.borderTop = '2px solid #333';
          if (col === 8) cell.style.borderRight = '2px solid #333';
          if (row === 8) cell.style.borderBottom = '2px solid #333';

          cell.addEventListener('click', () => {
            const prev = board.querySelector('.active');
            if (prev) prev.classList.remove('active');
            if (!cell.disabled) {
              selectedCell = cell;
              cell.classList.add('active');
            } else {
              selectedCell = null;
            }
          });

          board.appendChild(cell);
        }
      }
    }

    function generateSudokuPuzzle() {
      const emptyBoard = Array(9).fill(0).map(() => Array(9).fill(0));
      function isValid(board, row, col, num) {
        for (let i = 0; i < 9; i++) {
          if (board[row][i] === num || board[i][col] === num) return false;
        }
        const startRow = Math.floor(row / 3) * 3;
        const startCol = Math.floor(col / 3) * 3;
        for (let r = 0; r < 3; r++) {
          for (let c = 0; c < 3; c++) {
            if (board[startRow + r][startCol + c] === num) return false;
          }
        }
        return true;
      }

      function fillBoard(board) {
        for (let row = 0; row < 9; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] === 0) {
              const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9].sort(() => Math.random() - 0.5);
              for (const num of nums) {
                if (isValid(board, row, col, num)) {
                  board[row][col] = num;
                  if (fillBoard(board)) return true;
                  board[row][col] = 0;
                }
              }
              return false;
            }
          }
        }
        return true;
      }

      const board = JSON.parse(JSON.stringify(emptyBoard));
      fillBoard(board);
      const solved = board.map(row => row.map(n => n.toString()));

      const difficulty = document.getElementById('difficulty-select').value;
      let cellsToRemove = difficulty === 'easy' ? 35 : difficulty === 'medium' ? 45 : 55;

      const puzzle = board.map(row => row.slice());
      let removed = 0;
      while (removed < cellsToRemove) {
        const row = Math.floor(Math.random() * 9);
        const col = Math.floor(Math.random() * 9);
        if (puzzle[row][col] !== 0) {
          puzzle[row][col] = 0;
          removed++;
        }
      }

      const puzzleStr = puzzle.map(row => row.map(n => n === 0 ? '-' : n.toString()));
      return { puzzle: puzzleStr, solved };
    }

    document.querySelectorAll('.num').forEach(button => {
      button.addEventListener('click', () => {
        if (!selectedCell) return;
        const val = button.textContent;
        const row = selectedCell.dataset.row;
        const col = selectedCell.dataset.col;
        const correct = solution[row][col];
        if (val === correct) {
          selectedCell.value = val;
          selectedCell.disabled = true;
          selectedCell.classList.remove('error');
          selectedCell.classList.remove('active');
          selectedCell = null;
          checkVictory();
        } else {
          selectedCell.classList.add('error');
          errorCount++;
          updateErrors();
          if (errorCount >= 3) {
            endGame(false);
          }
        }
      });
    });

    document.getElementById('hint-btn').addEventListener('click', () => {
      giveHint();
    });

    generateGameBoard();
    startTimer();
  </script>
</body>
</html>
